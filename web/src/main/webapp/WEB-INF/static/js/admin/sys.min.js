$.sys={organization:{initSelectForm:function(d,c,a){var e=$.zTree.initSelectTree({zNodes:[],nodeType:"default",fullName:true,urlPrefix:ctx+"/admin/sys/organization/organization",async:true,asyncLoadAll:true,onlyDisplayShow:false,lazy:true,select:{btn:$("#selectOrganizationTree,#organizationName"),id:"organizationId",name:"organizationName",includeRoot:true},autocomplete:{enable:true}});
var b=$.zTree.initSelectTree({zNodes:[],urlPrefix:ctx+"/admin/sys/organization/job",async:true,asyncLoadAll:true,onlyDisplayShow:false,lazy:true,select:{btn:$("#selectJobTree,#jobName"),id:"jobId",name:"jobName",includeRoot:true},autocomplete:{enable:true},setting:{check:{enable:true,chkStyle:"checkbox",chkboxType:{Y:"",N:"s"}}}});
$(".btn-add-organization").click(function(){var g=$("#organizationId").val();
var f=$("#jobId").val();
if(a){if(!g&&!f){$.app.alert({message:"请至少选择一个组织机构或工作职务"});
return}}else{if(!g){$.app.alert({message:"请选择组织机构"});
return}if($("#organizationId_"+g).length>0){$.app.alert({message:"您已经选择了此组织机构，不能重复选择！"});
return}}var l=$("#organizationName").val();
var k=$("#jobName").val();
var h="<tr><td class='check'><input type='checkbox'></td><td><input type='hidden' id='organizationId_{organizationId}' name='{organizationFormName}' value='{organizationId}'>{organizationName}</td><td><input type='hidden' name='{jobFormName}' value='{jobId}'>{jobName}</td><td><a class='btn btn-link btn-edit btn-delete-organization' href='javascript:;' onclick='$.sys.organization.removeOrganization(this);'><i class='icon-trash'></i></a></td></tr>";
$("#selectedOrganization .table tbody").append(h.replace(/{organizationId}/g,g).replace("{organizationName}",l.replace(/,/g,"<br/>").replace(">","&gt;")).replace("{jobId}",f).replace("{jobName}",k.replace(/,/g,"<br/>").replace(">","&gt;")).replace("{organizationFormName}",d).replace("{jobFormName}",c));
$.table.initCheckbox($("#selectedOrganization table"));
var i=$.fn.zTree.getZTreeObj(b);
if(i){i.checkAllNodes(false)
}var j=$.fn.zTree.getZTreeObj(e);
if(j){j.checkAllNodes(false)
}$("#organizationId,#organizationName,#jobId,#jobName").val("")
});$.table.initCheckbox($("#selectedOrganization table"));
$(".btn-delete-all-organization").click(function(){var f=$.table.getAllSelectedCheckbox($("#selectedOrganization table"));
if(!f.length){return
}$.app.confirm({title:"确认删除组织机构和工作职务",message:"确认删除选中的组织机构和工作职务吗？",ok:function(){f.each(function(){$(this).closest("tr").remove()
})}})})},removeOrganizationBtn:function(){$("#selectOrganization").remove();
$(".btn-delete-organization").remove();
$(".btn-delete-all-organization").remove()
},removeOrganization:function(b){$.app.confirm({message:"确认删除吗？",ok:function(){$(b).closest("tr").remove()
}})}},user:{initValidator:function(a){var c={url:ctx+"/admin/sys/user/validate",extraDataDynamic:["#id"],alertTextLoad:"* 正在验证，请稍等。。。"};
$.validationEngineLanguage.allRules.ajaxCall=c;
$.validationEngineLanguage.allRules.username={regex:/^[\u4E00-\u9FA5\uf900-\ufa2d_a-zA-Z][\u4E00-\u9FA5\uf900-\ufa2d\w]{1,19}$/,alertText:"* 2到20个汉字、字母、数字或下划线组成，且必须以非数字开头"};
$.validationEngineLanguage.allRules.mobilePhoneNumber={regex:/^0{0,1}(13[0-9]|15[7-9]|153|156|18[7-9])[0-9]{8}$/,alertText:"* 手机号错误"};
var b=a.validationEngine();
return b},initUserListButton:function(){$(".change-password").click(function(){var c=$.table.getAllSelectedCheckbox($(".table"));
if(!c.length){return
}var d=c.val();
var b=ctx+"/admin/sys/user/changePassword?"+c.serialize();
var a=$.app.confirm({title:"修改密码",message:"请输入新密码：<br/><input type='password' id='password' class='input-medium'/>",ok:function(){var e=$("#password").val();
if(e){window.location.href=b+"&newPassword="+e
}}})});$(".block-user,.unblocked-user").click(function(){var d=$.table.getAllSelectedCheckbox($(".table"));
if(!d.length){return
}var f=d.val();
var a=$(this).is(".unblocked-user")?"normal":"blocked";
var b=ctx+"/admin/sys/user/changeStatus/"+a+"?"+d.serialize();
var e=a=="blocked"?"封禁用户":"解封用户";
var c=a=="blocked"?"请输入封禁原因:":"请输入解封原因：";
$.app.confirm({title:e,message:c+"<br/><textarea id='reason' style='width: 300px;height: 50px;'></textarea>",ok:function(){var g=$("#reason").val();
if(g){window.location.href=b+"&reason="+g
}}})});$(".status-history").click(function(){var c=$.table.getAllSelectedCheckbox($(".table"));
if(!c.length){return
}var b=$.app.joinVar(c.val());
var a=ctx+"/admin/sys/user/statusHistory?search.user.id_eq="+b;
$.app.modalDialog("状态改变历史",a,{width:800})
});$(".last-online-info").click(function(){var c=$.table.getAllSelectedCheckbox($(".table"));
if(!c.length){return
}var b=$.app.joinVar(c.val());
var a=ctx+"/admin/sys/user/lastOnline?search.userId_eq="+b;
$.app.modalDialog("最后在线历史",a,{width:800})
});$(".recycle").click(function(){var b=$.table.getAllSelectedCheckbox($(".table"));
if(!b.length){return
}var a=ctx+"/admin/sys/user/recycle?"+b.serialize();
$.app.confirm({title:"欢迎删除的用户",message:"确认还原吗？",ok:function(){window.location.href=a
}})})},initOnlineListButton:function(){$(".btn-force-logout").click(function(){var a=$.table.getAllSelectedCheckbox($(".table"));
if(!a.length){return
}$.app.confirm({message:"确认强制退出吗？",ok:function(){var b=ctx+"/admin/sys/user/online/forceLogout?"+a.serialize();
window.location.href=b
}})})}},auth:{initSelectRoleForm:function(){var b=$(".auth > .left > .list > ul");
var c=$(".auth > .right > .list > ul");
$([b,c]).sortable({connectWith:"ul",placeholder:"ui-state-highlight",stop:a}).disableSelection();
$(".btn-move-all-right").click(function(){b.find("li").appendTo(c);
a()});$(".btn-move-all-left").click(function(){c.find("li").appendTo(b);
a()});$(".auth > .left > .list").niceScroll({domfocus:true,hidecursordelay:2000});
$(".auth > .right > .list").niceScroll({domfocus:true,hidecursordelay:2000});
function a(){d();
var f=$("[name="+c.data("input-id")+"]");
var e=[];$(c).find("li").each(function(){var g=$(this).data("value");
e[e.length]=g
});f.val(e.join(","))
}function d(){$(".auth > .left > .list").getNiceScroll().resize();
$(".auth > .right > .list").getNiceScroll().resize()
}}}};