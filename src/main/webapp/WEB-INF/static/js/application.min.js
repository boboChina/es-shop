$.app={initIndex:function(){$.menus.initMenu();
$.layouts.initLayout();
$.tabs.initTab();
$.app.initCommonBtn();
var d=$.app.initMessage();
var e=$.app.initNotification();
var c=5*60*1000;
var a=ctx+"/admin/polling";
var b=function(f,g){$.ajax({url:f,async:true,cache:false,global:false,timeout:30*1000,dataType:"json",success:function(j,h,i){g(j);
j=null;h=null;
i=null;setTimeout(function(){b(f,g)
},10)},error:function(h,j,i){h=null;
j=null;i=null;
setTimeout(function(){b(f,g)
},30*1000)}})
};b(a,function(f){if(f){if(f.unreadMessageCount){d.update(f.unreadMessageCount)
}if(f.notifications){e.update(f.notifications)
}}})},initCommonBtn:function(){$(".btn-view-info,.btn-change-password").click(function(){var b=$(this);
var c="";if(b.is(".btn-view-info")){c=ctx+"/admin/sys/user/loginUser/viewInfo"
}else{if(b.is(".btn-change-password")){c=ctx+"/admin/sys/user/loginUser/changePassword"
}}setTimeout(function(){$.tabs.activeTab($.tabs.nextCustomTabIndex(),"个人资料",c,true)
},0)});$(".btn-view-message,.btn-message").click(function(){var a=ctx+"/admin/personal/message";
setTimeout(function(){$.tabs.activeTab($.tabs.nextCustomTabIndex(),"我的消息",a,true)
},0)});$(".btn-view-notice").click(function(){var a=ctx+"/office/personal/notice/list?read=false";
setTimeout(function(){$.tabs.activeTab($.tabs.nextCustomTabIndex(),"我的通知",a,true)
},0)});$(".btn-view-worklist,.btn-view-work").click(function(){var a=$(this);
var b=ctx+"/office/personal/worklist";
setTimeout(function(){if(a.is(".btn-view-work")){b=a.data("url")
}$.tabs.activeTab($.tabs.nextCustomTabIndex(),"我的待办工作",b,true)
},0);return false
})},initMessage:function(){var d=$(".btn-message");
var c=d.find(".icon-message");
var b=null;
var a=function(f){clearInterval(b);
if(f>0){var e=d.find(".icon-count");
if(!e.length){e=$("<i class='label label-important icon-count'></i>");
d.append(e)
}e.text(f);
d.addClass("unread");
b=setInterval(function(){c.toggleClass("icon-envelope-alt").toggleClass("icon-envelope")
},650)}};d.click(function(){clearInterval(b);
$($.find("#menu a:contains(我的消息)")).dblclick();
d.removeClass("unread");
d.find(".icon-count").remove();
c.removeClass("icon-envelope").addClass("icon-envelope-alt")
});a(d.data("unread"));
return{update:function(e){a(e)
}}},initNotification:function(){var q=$(".btn-notification");
var n=$(".notification-list");
var c=$(".notification-list .menu");
var f=c.find(".list");
var s=$(".notification-list .detail");
var h=s.find(".list");
var g=$(".notification-list .loading");
var u=$(".notification-list .no-comment");
var o=ctx+"/admin/personal/notification/markRead?id=";
var d='<li class="view-content {unread}"><span>{title}</span><span class="pull-right">{date}</span></li>';
var j='<div id="notificaiton-{id}" class="notification-detail" style="display: none"><div class="title"><span>{title}</span><span class="pull-right">{date}</span></div><div class="content">{content}</div></div>';
var t='<li class="view-all-notification"><span>&gt;&gt;查看所有通知</span></li>';
var m=function(){$($.find("#menu a:contains(我的通知)")).dblclick();
i();return false
};var i=function(){n.find(".content > div").hide();
n.removeClass("in");
$("body").off("click").find("iframe").contents().find("body").each(function(){$(this).off("click")
})};var k=function(){var v=s.find(".notification-detail");
var A=v.not(":hidden");
var w=v.index(A);
var z=s.find(".pre");
var x=s.find(".next");
z.removeClass("none");
x.removeClass("none");
if(w==0){z.addClass("none")
}var y=$(c.find(".view-content").get(w));
if(y.hasClass("unread")){y.removeClass("unread");
var B=A.attr("id").replace("notificaiton-","");
$.ajax({url:o+B,global:false,error:function(C,E,D){}})
}if(w==v.length-1){x.addClass("none")
}};var r=function(){n.find(".content > div").hide();
u.show()};var l=function(){n.find(".content > div").hide();
c.show()};var e=function(v){var w="";
$(v).each(function(x,y){w=w+j.replace("{id}",y.id).replace("{title}",y.title).replace("{date}",y.date).replace("{content}",y.content)
});h.html(w);
s.find(".notification-detail:first").show();
s.find(".back-notification-list").click(function(){a(s,c,"left")
});s.find(".pre").click(function(){var y=s.find(".notification-detail").not(":hidden");
var x=y.prev(".notification-detail");
if(x.length){a(y,x,"left")
}});s.find(".next").click(function(){var y=s.find(".notification-detail").not(":hidden");
var x=y.next(".notification-detail");
if(x.length){a(y,x,"right")
}});a(c,s,"right");
return false
};var b=function(v,x){var w="";
$(v).each(function(y,z){w=w+d.replace("{unread}",z.read?"":"unread").replace("{title}",z.title).replace("{date}",z.date)
});w=w+t;f.html(w);
c.find(".view-content").click(function(){e(v)
});c.find(".view-all-notification").click(function(){m()
});if(x){p()
}return false
};var a=function(x,w,v){x.css({position:"relative",width:"100%"});
x.stop(true).hide("slide",{direction:v=="left"?"rigth":"left"},function(){x.css({position:"",width:"",left:""})
});w.css({position:"absolute",top:w.is(".notification-detail")?w.closest(".detail").find(".title").outerHeight()+"px":"0px",left:"0px",width:"100%",display:"none"});
w.stop(true).show("slide",{direction:v},function(){w.css({position:"",left:"",top:"",width:""});
if(w.is(".notification-detail")||w.is(".detail")){k()
}})};var p=function(){n.addClass("in");
var v=function(w){var x=$(w.target);
if(!x.closest(".btn-notification").length&&!x.closest(".notification-list").length){i()
}};$("body").on("click",v).find("iframe").contents().find("body").each(function(){$(this).on("click",v)
});if(c.find(".view-content").length){l()
}else{r()}};
q.click(function(){if(n.hasClass("in")){i()
}else{p()}});
n.find(".close-notification-list").click(function(){i()
});i();return{update:function(x){if(!x.length){r();
return}var z=false;
for(var w=0,v=x.length;
w<v;w++){var y=x[w];
if(!y.read){z=true;
y.title=y.title.replace("{ctx}",ctx);
y.content=y.content.replace("{ctx}",ctx)
}}b(x,z)}}},loadingToCenterIframe:function(a,b,e,f){a.data("url",b);
var c=a.prop("id");
var g="iframe-"+c;
var d=$("#"+g);
if(!d.length||f){if(!d.length){d=$("iframe[tabs=true]:last").clone(true);
d.prop("id",g);
$("iframe[tabs=true]:last").after(d)
}$.app.waiting(e);
d.prop("src",b).one("load",function(){$.app.activeIframe(c,d);
$.app.waitingOver()
})}else{$.app.activeIframe(c,d)
}},activeIframe:function(a,b){if(!b){b=$("#iframe-"+a)
}var c=$.layouts.layout;
if(c.panes.center.prop("id")==b.prop("id")){return
}c.panes.center.hide();
c.panes.center=b;
c.panes.center.show();
c.resizeAll();
$.tabs.initTabScrollHideOrShowMoveBtn(a)
},waiting:function(a,b){if(!a){a="装载中..."
}a='<img src="'+ctx+'/static/images/loading.gif" '+(b?"width='20px'":"")+"/> "+a;
if(!b){a="<h4>"+a+"</h4>"
}$.blockUI({fadeIn:700,fadeOut:700,showOverlay:false,css:{border:"none",padding:"15px",backgroundColor:"#eee","-webkit-border-radius":"10px","-moz-border-radius":"10px",opacity:1,color:"#000",width:b?"40%":"30%"},message:a})
},waitingOver:function(){$.unblockUI()
},_modalDialogQueue:null,modalDialog:function(d,a,c){$.app.waiting();
var b={title:d,closeText:"关闭",closeOnEscape:false,height:300,width:600,modal:true,noTitle:false,close:function(){$(this).closest(".ui-dialog").remove()
},_close:function(e){$(e).dialog("close");
if($.app._modalDialogQueue.length>0){$.app._modalDialogQueue.pop()
}},buttons:{"确定":function(){if(c.ok){if(c.ok($(this))){c._close(this)
}}else{c._close(this)
}if(c.callback){c.callback()
}},"关闭":function(){c._close(this);
if(c.callback){c.callback()
}}}};if(!c){c={}
}c=$.extend(true,{},b,c);
if(!c.ok){delete c.buttons["确定"]
}$.ajax({url:a,headers:{table:true}}).done(function(f){$.app.waitingOver();
var g=$("<div></div>").append(f);
var e=g.dialog(c).closest(".ui-dialog").data("url",a).removeClass("ui-widget-content").find(".ui-dialog-content ").removeClass("ui-widget-content").focus();
if(c.noTitle){e.closest(".ui-dialog").find(".ui-dialog-titlebar").addClass("no-title")
}e.closest(".ui-dialog").focus();
if(!$.app._modalDialogQueue){$.app._modalDialogQueue=new Array()
}$.app._modalDialogQueue.push(e);
$.table.initTable(g.find(".table"))
})},cancelModelDialog:function(){if($.app._modalDialogQueue&&$.app._modalDialogQueue.length>0){$.app._modalDialogQueue.pop().dialog("close")
}},alert:function(a){if(!a){a={}
}var b={title:"警告",message:"非法的操作",okTitle:"关闭",ok:$.noop};
a.alert=true;
a=$.extend({},b,a);
this.confirm(a)
},confirm:function(a){var f={title:"确认执行操作",message:"确认执行操作吗？",cancelTitle:"取消",okTitle:"确定",cancel:$.noop,ok:$.noop,alert:false};
if(!a){a={}
}a=$.extend({},f,a);
var c='<div class="modal hide fade confirm"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button><h3 class="title">{title}</h3></div><div class="modal-body"><div>{message}</div></div><div class="modal-footer"><a href="#" class="btn btn-ok btn-danger" data-dismiss="modal">{okTitle}</a><a href="#" class="btn btn-cancel" data-dismiss="modal">{cancelTitle}</a></div></div>';
var e=$(c.replace("{title}",a.title).replace("{message}",a.message).replace("{cancelTitle}",a.cancelTitle).replace("{okTitle}",a.okTitle));
var b=false;
if(a.alert){e.find(".modal-footer > .btn-cancel").remove()
}else{e.find(".modal-footer > .btn-cancel").click(function(){b=true;
a.cancel()})
}e.find(".modal-footer > .btn-ok").click(function(){b=true;
a.ok()});var d=e.modal();
d.on("hidden",function(){d.remove();
if(b){return true
}if(a.alert){a.ok()
}else{a.cancel()
}});return d
},isImage:function(a){return/gif|jpe?g|png|bmp$/i.test(a)
},initDatetimePicker:function(){$(".date:not(.custom)").each(function(){var c=$(this);
if(c.attr("initialized")=="true"){return
}var b=$(this).find("[data-format]").data("format").toLowerCase().indexOf("yyyy-mm-dd")!=-1;
var a=$(this).find("[data-format]").data("format").toLowerCase().indexOf("hh:mm:ss")!=-1;
c.datetimepicker({pickDate:b,pickTime:a,maskInput:true,language:"zh-CN"}).on("changeDate",function(d){if(a==false){$(this).data("datetimepicker").hide()
}});c.find(":input").click(function(){c.find(".icon-calendar,.icon-time,.icon-date").click()
});c.attr("initialized",true)
})},initCalendar:function(){var c=new Date();
var g=c.getDate();
var a=c.getMonth();
var i=c.getFullYear();
var f=$("#calendar").fullCalendar({header:{left:"prev,next today",center:"title",right:"month,agendaWeek,agendaDay"},events:ctx+"/admin/personal/calendar/load",eventDrop:function(d,j){e(d)
},eventClick:function(d,j){h(d)
},loading:function(d){if(d){$("#loading").show()
}else{$("#loading").hide()
}},editable:true,selectable:true,selectHelper:true,select:function(k,d,j){b(k,d);
f.fullCalendar("unselect")
}});$("span.fc-button-prev").before('<span class="fc-button fc-button-add fc-state-default fc-corner-left fc-corner-right">新增</span>');
$(".fc-button-add").click(function(){b()
});function b(k,d){var j=ctx+"/admin/personal/calendar/new";
if(k){k=$.fullCalendar.formatDate(k,"yyyy-MM-dd HH:mm:ss");
d=$.fullCalendar.formatDate(d,"yyyy-MM-dd HH:mm:ss");
j=j+"?start="+k+"&end="+d
}$.app.modalDialog("新增提醒事项",j,{width:370,height:430,ok:function(n){var m=n.find("#editForm");
if(!m.validationEngine("validate")){return false
}var l=ctx+"/admin/personal/calendar/new";
$.post(l,m.serialize(),function(){f.fullCalendar("refetchEvents")
});return true
}})}function e(k){var j=ctx+"/admin/personal/calendar/move";
var m=k.id;
var l=$.fullCalendar.formatDate(k.start,"yyyy-MM-dd HH:mm:ss");
var d=$.fullCalendar.formatDate(k.end,"yyyy-MM-dd HH:mm:ss");
j=j+"?id="+m;
j=j+"&start="+l+"&end="+d;
$.post(j,function(){f.fullCalendar("refetchEvents")
})}function h(j){var d=ctx+"/admin/personal/calendar/view/"+j.id;
$.app.modalDialog("查看提醒事项",d,{width:370,height:250,noTitle:false,okBtn:false,closeBtn:false})
}$("body").on("click",".btn-delete-calendar",function(){var d=$(this);
$.app.confirm({title:"确认删除提醒事项吗？",message:"确认删除提醒事项吗？",ok:function(){var j=ctx+"/admin/personal/calendar/delete?id="+d.data("id");
$.post(j,function(){f.fullCalendar("refetchEvents");
$.app.closeModalDialog()
})}})})},removeContextPath:function(a){if(a.indexOf(ctx)==0){return a.substr(ctx.length)
}return a},asyncLoad:function(b,a){if(b.is("form")){b.submit(function(){if(b.prop("method").toLowerCase()=="post"){$.post(b.prop("action"),b.serialize(),function(c){$("#"+a).replaceWith(c)
})}else{$.get(b.prop("action"),b.serialize(),function(c){$("#"+a).replaceWith(c)
})}return false
})}else{if(b.is("a")){b.click(function(){$.get(b.prop("href"),function(c){$("#"+a).replaceWith(c)
});return false
})}else{$.app.alert({message:"该标签不支持异步加载，支持的标签有form、a"})
}}},readonlyForm:function(c,b){var a=$(c).find(":input");
a.not(":submit,:button").prop("readonly",true);
if(b){a.remove(":button,:submit")
}},joinVar:function(a,b){if(!b){b=","
}var c=new Array();
$(a).each(function(){c.push($(this).val())
});return c.join(b)
},toggleLoadTable:function(d,b){var a="icon-plus-sign";
var c="icon-minus-sign";
$(d).find("tr .toggle-child").click(function(){var i=$(this);
i.closest("table").find(".toggle-child."+c).not(i).removeClass(c).addClass(a).end().end().find(".child-data").not(i.closest("tr").next("tr")).hide();
if($(this).closest("html").hasClass("ie7")){var e=$(this).clone(true);
if(e.hasClass(c)){e.addClass(a).removeClass(c)
}else{e.addClass(c).removeClass(a)
}$(this).after(e);
$(this).remove();
i=e}else{i.toggleClass(a);
i.toggleClass(c)
}var h=i.closest("tr");
var f=h.next("tr");
if(!f.hasClass("child-data")){$.app.waiting();
f=$("<tr class='child-data' style='display: none;'></tr>");
var g=$("<td colspan='"+h.find("td").size()+"'></td>");
f.append(g);
h.after(f);
g.load(b.replace("{parentId}",i.data("id")),function(){$.app.waitingOver()
})}f.toggle();
return false
})},initAutocomplete:function(b){var a={minLength:1,enterSearch:false,focus:function(c,d){$(b.input).val(d.item.label);
return false
},renderItem:function(c,d){return $("<li>").data("ui-autocomplete-item",d).append("<a>"+d.label+"</a>").appendTo(c)
}};b=$.extend(true,a,b);
$(b.input).on("keydown",function(c){if(b.enterSearch&&c.keyCode===$.ui.keyCode.ENTER){b.select(c,{item:{value:$(this).val()}})
}}).autocomplete({source:b.source,minLength:b.minLength,focus:b.focus,select:b.select}).data("ui-autocomplete")._renderItem=b.renderItem
}};$.layouts={layout:null,initLayout:function(){function a(h,f,b,e,c){var d=$(".tabs-fix-top");
if(h=="north"){var g=0;
if($("html").hasClass("ie")){g=f.height()-33
}else{g=f.height()-30
}if(b.isClosed){g=-58
}d.css("top",g)
}if(h=="center"){d.find(".ul-wrapper").andSelf().width(b.layoutWidth);
$.tabs.initTabScrollHideOrShowMoveBtn()
}}this.layout=$(".index-panel").layout({west__size:210,south__size:30,west__spacing_closed:20,west__togglerLength_closed:100,west__togglerContent_closed:"菜<BR>单",togglerTip_closed:"打开",togglerTip_open:"关闭",sliderTip:"滑动打开",resizerTip:"调整大小",onhide:a,onshow:a,onopen:a,onclose:a,onresize:a,center__maskContents:true,north:{togglerLength_open:0,resizable:false,size:95},south:{resizable:false}})
}};$.menus={initMenu:function(){var c=$("#menu");
c.accordion({header:"h3",heightStyle:"content",icons:{header:"icon-caret-right",activeHeader:"icon-caret-down"},animate:{easing:"easeOutQuart"}});
c.find(".ui-accordion-header-icon").removeClass("ui-icon").addClass("menu-header-icon");
var d="menu-icon icon-angle-right";
var b="menu-icon icon-double-angle-right";
var a="menu-icon icon-double-angle-down";
c.find("li").each(function(){var e=$(this);
e.children("a").wrap("<div class='li-wrapper'></div>");
var f=e.children(".li-wrapper");
var h=e.find("ul");
var g=h.length;
if(g){h.hide();
f.prepend('<span class="'+b+'"></span>').click(function(){if(f.children("span").hasClass(a)){f.children("span").removeClass(a).addClass(b).end().closest("li").children("ul").hide("blind")
}else{f.children("span").removeClass(b).addClass(a).end().closest("li").children("ul").show("blind")
}})}else{f.prepend('<span class="'+d+'"></span>')
}});c.find("a").each(function(){var e=$(this);
var h=e.text();
var f=e.attr("href");
e.attr("href","#");
if(f=="#"||f==""){return
}var g=function(j,k){c.find("a").closest("li > .li-wrapper").removeClass("active");
j.closest("li > .li-wrapper").addClass("active");
var l=j.data("panelIndex");
var i=function(m){if(!j.data("panelIndex")){j.data("panelIndex",m);
j.attr("id","menu-"+m)
}};$.tabs.activeTab(l,h,f,k,i);
return false
};e.closest("li").click(function(){g(e,false);
return false
}).dblclick(function(){g(e,true);
return false
})})}};$.tabs={tabs:null,maxTabIndex:1,customTabStartIndex:9999999999,initTab:function(){function a(c){var d=$("#menu-"+c.replace("tabs-",""));
$("#menu .li-wrapper.active").removeClass("active");
if(d.length){d.parents("ul").each(function(){if($(this).css("display")=="none"){$(this).prev("a").click()
}});d.closest(".li-wrapper").addClass("active")
}}var b=$(".tabs-bar").tabs({beforeActivate:function(c,d){setTimeout(function(){var e=$.tabs.tabs;
e.find(".menu").hide();
e.find("#"+d.newPanel.attr("aria-labelledby")).siblings(".menu").show()
},0)},activate:function(c,d){setTimeout(function(){var e=$.tabs.tabs;
var f=d.newPanel.prop("id");
a(f);$.app.activeIframe(f)
},0)}});$.tabs.tabs=b;
b.delegate("span.icon-remove","click",function(){var c=$(this).closest("li").remove().attr("aria-controls");
setTimeout(function(){$.tabs.removeTab(c)
},0)});b.delegate("span.icon-refresh","click",function(){var c=$(this).closest("li").attr("aria-controls");
setTimeout(function(){$.tabs.activeTab(c,null,null,true)
},0)});b.bind("keyup",function(d){if(d.altKey&&d.keyCode===$.ui.keyCode.BACKSPACE){var c=b.find(".ui-tabs-active").remove().attr("aria-controls");
setTimeout(function(){$.tabs.removeTab(c)
},0)}});$.tabs.initTabScroll();
$.tabs.initTabContextMenu()
},removeTab:function(c){var b=$.tabs.tabs;
var a=$("#"+c);
var e=$("#iframe-"+c);
var f=$("#menu-"+c.replace("tabs-",""));
if(f.length){f.attr("id","");
f.attr("panelIndex","");
$("#menu .li-wrapper.active").removeClass("active")
}b.tabs("option","active",b.find(".ui-tabs-panel").size());
b.tabs("refresh");
a.remove();
var g=e[0];
g.src="";g.contentWindow.document.write("");
g.contentWindow.close();
e.remove();
var d=!-[1,];
if(d){CollectGarbage()
}},createTab:function(g,f){var d=$.tabs.tabs;
if(d.find(".ui-tabs-panel").length>20){$.app.alert({message:"您打开的面板太多，为提高系统运行速度，请先关闭一些！"});
return}var c=f||$.tabs.maxTabIndex++||1;
var h="tabs-"+c;
var e="<li><a href='#{href}'>{label}</a> <span class='menu icon-remove' role='presentation'title='关闭'></span><br/><span class='menu icon-refresh' role='presentation' title='刷新'></span></li>";
var a=$(e.replace(/\{href\}/g,h).replace(/\{label\}/g,g));
d.find("ul.ui-tabs-nav").append(a);
d.append('<div id="'+h+'"></div>');
d.tabs("refresh");
var b=$("#"+h);
b.data("index",c);
return b},activeTab:function(b,f,a,e,g){var c=$.tabs.tabs;
if(b&&(""+b).indexOf("tabs-")==0){d=$("#"+b)
}else{var d=$("#tabs-"+b)
}if(!d.length){d=$.tabs.createTab(f,b)
}if(g){g(d.data("index"))
}if(!a){a=d.data("url")
}setTimeout(function(){$.app.loadingToCenterIframe(d,a,null,e);
c.tabs("option","active",c.find(".ui-tabs-panel").index(d))
},0);return d.data("index")
},initTabScrollHideOrShowMoveBtn:function(b){var k=$(".tabs-bar .ul-wrapper");
var l=k.find("ul li:last");
var i=k.find("ul li:first");
var a=k.offset().left;
var g=a+k.width();
var e=function(){var p=l.offset().left;
var o=p+l.width();
var m=i.offset().left;
var n=$(".tabs-bar .icon-chevron-left");
var q=$(".tabs-bar .icon-chevron-right");
if(a==m){n.hide()
}else{n.show()
}if(g>=o){q.hide()
}else{q.show()
}};if(b){var h=$(".tabs-bar").find("li[aria-labelledby='"+$("#"+b).attr("aria-labelledby")+"']");
var d=h.offset().left;
var j=d+h.width();
var f=h.attr("aria-controls")==l.attr("aria-controls");
if((a<=d)&&(j<=g)&&!f){return
}var c=0;if(g<j||f){c=k.scrollLeft()+(j-g)+(f?10:55)
}else{c="-="+(a-d+55)
}k.animate({scrollLeft:c},600,function(){e()
})}else{e()
}},initTabScroll:function(){var a=function(b){return function(){var g=$(".tabs-bar .ul-wrapper");
var d=g.find("ul li:last");
var e=g.scrollLeft()+b;
var f=g.offset().left+g.width();
var h=d.offset().left+d.width();
var c=h-f;if(b>0){if(c<=b+b/2){e=g.scrollLeft()+c
}if(c<=0){return
}}if(b<0){if(e<-b){e=0
}}if(e<0){e=0
}g.animate({scrollLeft:e},600,function(){$.tabs.initTabScrollHideOrShowMoveBtn()
})}};$(".tabs-bar .icon-chevron-left").click(function(){setTimeout(function(){a(-200)()
},0)});$(".tabs-bar .icon-chevron-right").click(function(){setTimeout(function(){a(200)()
},0)})},initTabContextMenu:function(){var c=$("#tabs-menu");
$(document).bind("contextmenu",function(g){var f=$(g.target);
var h=f.closest(".tabs-bar").length&&f.is(".ui-tabs-anchor");
if(h&&f.attr("href")=="#tabs-0"){return true
}if(h){b(f.attr("id"),g.pageX-5,g.pageY-5);
c.mouseleave(function(){a()
});return false
}return true
});function a(){c.hide();
c.data("tabId","")
}function b(f,e,g){c.data("tabId",f);
c.css("left",e).css("top",g);
c.show()}function d(e){$("#"+e).parent().find(".icon-remove").click()
}c.find(".close-current").click(function(g){var f=c.data("tabId");
d(f);a()});
c.find(".close-others").click(function(h){var f=c.data("tabId");
var g=$.tabs.tabs.find(".ul-wrapper > ul > li > a");
g.each(function(){var e=this.id;
if(e!=f){d(e)
}});a()});c.find(".close-all").click(function(h){var f=c.data("tabId");
var g=$.tabs.tabs.find(".ul-wrapper > ul > li > a");
g.each(function(){var e=this.id;
d(e)});a()});
c.find(".close-left-all").click(function(i){var f=c.data("tabId");
var g=$.tabs.tabs.find(".ul-wrapper > ul > li > a");
var h=g.index($("#"+f));
g.each(function(j){if(j<h){var e=this.id;
d(e)}});a()
});c.find(".close-right-all").click(function(i){var f=c.data("tabId");
var g=$.tabs.tabs.find(".ul-wrapper > ul > li > a");
var h=g.index($("#"+f));
g.each(function(j){if(j>h){var e=this.id;
d(e)}});a()
})},nextCustomTabIndex:function(){var b=$.tabs.tabs;
var a=$.tabs.customTabStartIndex;
b.find(".ui-tabs-panel").each(function(){var c=parseInt($(this).attr("id").replace("tabs-"));
if(a<c){a=c
}});return a+1
}};$.parentchild={initChildForm:function(b){var d={form:$("#childForm"),tableId:"childTable",excludeInputSelector:"",trId:"",validationEngine:null};
if(!b){b={}
}b=$.extend({},d,b);
if(b.trId){var c=$("#"+b.trId);
if(c.length&&c.find(":input").length){var a=1;
$(":input",b.form).not(b.excludeInputSelector).each(function(){var g=$(this);
var e=c.find(":input").eq(a++);
if(!e.length){return
}var f=e.clone(true).show();
f.prop("name",f.prop("name").replace(b.trId,""));
f.prop("id",f.prop("id").replace(b.trId,""));
if(e.is("select")){e.find("option").each(function(h){f.find("option").eq(h).prop("selected",$(this).prop("selected"))
})}if(e.is(":radio,:checkbox")){f.prop("checked",e.prop("checked"))
}f.replaceAll(g)
})}}$(":input,label",b.form).each(function(){var e="child_";
if($(this).is(":input")){var g=$(this).prop("id");
if(g&&g.indexOf(e)!=0){$(this).prop("id",e+g)
}}else{var f=$(this).prop("for");
if(f&&f.indexOf(e)!=0){$(this).prop("for",e+f)
}}});b.form.submit(function(){if(b.validationEngine&&!b.validationEngine.validationEngine("validate")){return false
}return $.parentchild.saveModalFormToTable(b)
})},saveModalFormToTable:function(c){var b=$("#"+c.tableId);
var h=b.children("tbody");
if(!c.trId||c.alwaysNew){var a=h.data("counter");
if(!a){a=0}c.trId="new_"+a++;
h.data("counter",a)
}var g=$("#"+c.trId,h);
var e=$("<tr></tr>");
e.prop("id",c.trId);
if(!g.length||c.alwaysNew){h.append(e)
}else{g.replaceWith(e)
}var f=$("<td></td>");
e.append(f.clone(true).addClass("check").append("<input type='checkbox'>"));
var d=$(":input",c.form).not(":button,:submit,:reset",c.form);
if(c.excludeInputSelector){d=d.not(c.excludeInputSelector)
}d=d.filter(function(){return d.filter("[name='"+$(this).prop("name")+"']").index($(this))==0
});d.each(function(){var j=$("[name='"+$(this).prop("name")+"']",c.form);
var i=j.val();
if(j.is(":radio,:checkbox")){i="";
j.filter(":checked").each(function(){if(i!=""){i=i+","
}i=i+$("label[for='"+$(this).prop("id")+"']").text()
})}if(j.is("select")){i="";
j.find("option:selected").each(function(){if(i!=""){i=i+","
}i=i+$(this).text()
})}j.each(function(){if($(this).is("[id]")){$(this).prop("id",c.trId+$(this).prop("id"))
}$(this).prop("name",c.trId+$(this).prop("name"))
});e.append(f.clone(true).append(i).append(j.hide()))
});$.table.initCheckbox(b);
$.app.cancelModelDialog();
return false
},updateChild:function(a,c,b){if(c.indexOf("?")>0){c=c+"&"
}else{c=c+"?"
}c=c+"trId={trId}";
if(a.is("[id^='old']")){c=c.replace("{id}",a.prop("id").replace("old_",""))
}else{c=c.replace("{id}",0)
}c=c.replace("{trId}",a.prop("id"));
$.app.modalDialog("修改",c,b)
},copyChild:function(a,c,b){if(c.indexOf("?")>0){c=c+"&"
}else{c=c+"?"
}c=c+"trId={trId}";
c=c+"&copy=true";
if(a.is("[id^='old']")){c=c.replace("{id}",a.prop("id").replace("old_",""))
}else{c=c.replace("{id}",0)
}c=c.replace("{trId}",a.prop("id"));
$.app.modalDialog("复制",c,b)
},deleteChild:function(b,a){$.app.confirm({message:"确认删除吗？",ok:function(){var c=b.closest("tr");
if(c.prop("id").indexOf("old_")==0){a=a.replace("{id}",c.prop("id").replace("old_",""));
$.post(a,function(){c.remove()
})}else{c.remove()
}}})},initParentForm:function(b){var a=$("#"+b.tableId);
$.table.initCheckbox(a);
$(window).on("beforeunload",function(){if(a.find(":input").length){return"确定离开当前编辑页面吗？"
}});$(".btn-create-child").click(function(){$.app.modalDialog("新增",b.createUrl,b.modalSettings)
});$(".btn-update-child").click(function(){var c=a.find("tbody tr").has(".check :checkbox:checked:first");
if(!c.length){$.app.alert({message:"请先选择要修改的数据！"});
return}$.parentchild.updateChild(c,b.updateUrl,b.modalSettings)
});$(".btn-copy-child").click(function(){var c=a.find("tbody tr").has(".check :checkbox:checked:first");
if(!c.length){$.app.alert({message:"请先选择要复制的数据！"});
return}$.parentchild.copyChild(c,b.updateUrl,b.modalSettings)
});$(".btn-delete-child").click(function(){var c=a.find("tbody tr").has(".check :checkbox:checked");
if(!c.length){$.app.alert({message:"请先选择要删除的数据！"});
return}$.app.confirm({message:"确定删除选择的数据吗？",ok:function(){var d=new Array();
c.each(function(){var e=$(this).prop("id");
if(e.indexOf("old_")==0){e=e.replace("old_","");
d.push({name:"ids",value:e})
}});$.post(b.batchDeleteUrl,d,function(){c.remove();
$.table.changeBtnState(a)
})}})});b.form.submit(function(){$(window).unbind("beforeunload");
a.find("tbody tr").each(function(c){var d=$(this);
d.find(".check > :checkbox").attr("checked",false);
d.find(":input").each(function(){if($(this).prop("name").indexOf(b.prefixParamName)!=0){$(this).prop("name",b.prefixParamName+"["+c+"]."+$(this).prop("name").replace(d.prop("id"),""))
}})})})}};$.table={initTable:function(a){if(!a||!a.length||a.attr("initialized")=="true"){return
}a.attr("initialized","true");
$.table.initSort(a);
$.table.initSearchForm(a);
if(a.is(".move-table")){$.movable.initMoveableTable(a)
}$.table.initTableBtn(a);
$.table.initDeleteSelected(a);
$.table.initUpdateSelected(a);
$.table.initCreate(a);
$.table.initCheckbox(a);
$.table.changeBtnState(a)
},initCheckbox:function(b){var a="active";
b.find("td.check").each(function(){var c=$(this).find(":checkbox,:radio");
c.off("click").on("click",function(e){var d=c.is(":checked");
if(!d){c.closest("tr").removeClass(a)
}else{c.closest("tr").addClass(a)
}$.table.changeBtnState(b);
e.stopPropagation()
});$(this).closest("tr").off("click").on("click",function(e){var d=c.is(":checked");
if(d){c.closest("tr").removeClass(a)
}else{c.closest("tr").addClass(a)
}c.prop("checked",!d);
$.table.changeBtnState(b)
})});b.find(".check-all").off("click").on("click",function(){var c=$(this);
if(c.text()=="全选"){c.text("取消");
b.find("td.check :checkbox").prop("checked",true).closest("tr").addClass(a)
}else{c.text("全选");
b.find("td.check :checkbox").prop("checked",false).closest("tr").removeClass(a)
}$.table.changeBtnState(b)
});b.find(".reverse-all").off("click").on("click",function(){b.find("td.check :checkbox").each(function(){var d=$(this);
var c=d.is(":checked");
if(c){d.closest("tr").removeClass(a)
}else{d.closest("tr").addClass(a)
}d.prop("checked",!c);
$.table.changeBtnState(b)
})})},changeBtnState:function(c){var a=c.find("td.check :checkbox:checked").length;
var b=c.closest(".panel").find(".tool .btn").not(".no-disabled");
if(a){b.removeClass("disabled");
b.each(function(){var e=$(this);
var d=e.data("btn-state-href");
if(d){e.attr("href",d)
}})}else{b.addClass("disabled");
b.each(function(){var e=$(this);
var d=e.attr("href");
if(d){e.data("btn-state-href",d);
e.removeAttr("href")
}})}},initSearchForm:function(c){var d=$(c).attr("id");
var b=c.closest("[data-table='"+d+"']").find(".search-form");
if(!b.length){return
}b.find(".btn").addClass("no-disabled");
b.find(".btn-clear-search").click(function(){if(c.data("async")==true){var e=b.find("input[type='reset']");
if(!e.length){b.append("<input type='reset' style='display:none'>");
e=b.find("input[type='reset']")
}e.click()}a(c,b,true)
});var a=function(h,g,e){var f=$.table.tableURL(h);
f=$.table.removeSearchParam(f,g);
f=$.table.removePageParam(f,g);
if(!e){if(f.indexOf("?")==-1){f=f+"?"
}else{f=f+"&"
}f=f+g.serialize()
}$.table.reloadTable(h,f,null)
};b.off("submit").on("submit",function(){a(c,b,false);
return false
});if(b.is("[data-change-search=true]")){b.find(":input:not(:button,:submit,:reset)").off("change").on("change",function(f){b.off("submit").on("submit",function(){return false
});a(c,b,false)
})}b.find(".btn-search-all").off("click").on("click",function(){a(c,b,true);
return false
})},initSort:function(c){if(!c.length){return
}var d=$.table.getPrefix(c);
var b=$.table.tableURL(c);
var a='<div class="sort"><a class="{sort-icon}" href="#" title="排序"></a></div>';
c.find("[sort]").each(function(){var i=$(this);
var h=d+"sort."+i.attr("sort");
var g=null;
var f=b.match(new RegExp(h+"=(asc|desc)","gi"));
var e=null;
if(f){e=RegExp.$1;
if(e=="asc"){g=a.replace("{sort-icon}","sort-hover icon-arrow-up")
}else{if(e=="desc"){g=a.replace("{sort-icon}","sort-hover icon-arrow-down")
}}}if(g==null){g=a.replace("{sort-icon}","icon-arrow-down")
}i.wrapInner("<div class='sort-title'></div>").append($(g));
i.prop("order",e);
i.addClass("sort-th").click(function(){b=$.table.tableURL(c);
b=$.table.removeSortParam(b);
if(!e){e="asc"
}else{if(e=="asc"){e="desc"
}else{if(e=="desc"){e="asc"
}}}if(e){b=b+(b.indexOf("?")==-1?"?":"&");
b=b+h+"="+e
}$.table.reloadTable(c,b,null)
})})},turnPage:function(a,b,f){var c=$(f).closest(".table-pagination").prev("table");
if(!c.length){c=$(f).closest("table")
}var e=$.table.tableURL(c);
e=$.table.removePageParam(e);
e=e+(e.indexOf("?")==-1?"?":"&");
var d=$.table.getPrefix(c);
e=e+d+"page.pn="+b;
if(a){e=e+"&"+d+"page.size="+a
}$.table.reloadTable(c,e,null)
},reloadTable:function(e,c,b){if(!c){c=$.table.tableURL(e)
}if(!b){b=c
}e.closest(".ui-dialog").data("url",b);
if(e.data("async")==true){$.app.waiting();
var d=e.attr("id");
var a=e.data("async-container");
var f={};if(!a){f.table=true
}else{f.container=true
}$.ajax({url:c,async:true,headers:f}).done(function(h){if(a){$("#"+a).replaceWith(h)
}else{var g=e.next(".table-pagination");
if(g.length){g.remove()
}e.replaceWith(h)
}e=$("#"+d);
e.data("url",b);
$.table.initTable(e);
var i=e.data("async-callback");
if(i&&window[i]){window[i](e)
}$.app.waitingOver()
})}else{window.location.href=c
}},tableURL:function(b){var c=b.closest(".ui-dialog");
var a=b.data("url");
if(!a&&c.length){a=c.data("url")
}if(!a){a=window.location.href
}if(a.indexOf("#")>0){a=a.substring(0,a.indexOf("#"))
}return a},encodeTableURL:function(a){return encodeURIComponent($.table.tableURL(a))
},getPrefix:function(a){var b=a.data("prefix");
if(!b){b=""
}else{b=b+"_"
}return b},removePageParam:function(a){a=a.replace(/\&\w*page.pn=\d+/gi,"");
a=a.replace(/\?\w*page.pn=\d+\&/gi,"?");
a=a.replace(/\?\w*page.pn=\d+/gi,"");
a=a.replace(/\&\w*page.size=\d+/gi,"");
a=a.replace(/\?\w*page.size=\d+\&/gi,"?");
a=a.replace(/\?\w*page.size=\d+/gi,"");
return a},removeSortParam:function(a){a=a.replace(/\&\w*sort.*=((asc)|(desc))/gi,"");
a=a.replace(/\?\w*sort.*=((asc)|(desc))\&/gi,"?");
a=a.replace(/\?\w*sort.*=((asc)|(desc))/gi,"");
return a},removeSearchParam:function(a,b){$.each(b.serializeArray(),function(){var c=this.name;
a=a.replace(new RegExp(c+"=.*?&","g"),"");
a=a.replace(new RegExp("[&?]"+c+"=.*$","g"),"")
});return a
},formatUrlPrefix:function(a,b){if(!a){a=b.data("prefix-url")
}if(!a&&b&&b.length){a=decodeURIComponent($.table.tableURL(b))
}if(!a){a=currentURL
}if(a.indexOf("?")>=0){return a.substr(0,a.indexOf("?"))
}return a},initDeleteSelected:function(b,a){if(!b||!b.length){return
}var c=b.closest("[data-table='"+b.attr("id")+"']").find(".btn-delete:not(.btn-custom)");
a=$.table.formatUrlPrefix(a,b);
c.off("click").on("click",function(){var d=$.table.getAllSelectedCheckbox(b);
if(!d.length){return
}$.app.confirm({message:"确定删除选择的数据吗？",ok:function(){window.location.href=a+"/batch/delete?"+d.serialize()+"&BackURL="+$.table.encodeTableURL(b)
}})})},initUpdateSelected:function(b,a){if(!b||!b.length){return
}var c=b.closest("[data-table='"+b.attr("id")+"']").find(".btn-update:not(.btn-custom)");
a=$.table.formatUrlPrefix(a,b);
c.off("click").on("click",function(){var d=$.table.getFirstSelectedCheckbox(b);
if(!d.length){return
}var e=d.val();
window.location.href=a+"/"+e+"/update?BackURL="+$.table.encodeTableURL(b)
})},initCreate:function(b,a){if(!b||!b.length){return
}var c=b.closest("[data-table='"+b.attr("id")+"']").find(".btn-create");
c.addClass("no-disabled");
c.off("click").on("click",function(){var d=$.table.formatUrlPrefix(a,b)+"/create";
if(c.attr("href")){d=c.attr("href")
}window.location.href=d+(d.indexOf("?")==-1?"?":"&")+"BackURL="+$.table.encodeTableURL(b);
return false
})},initTableBtn:function(b,a){if(!b||!b.length){return
}b.closest("[data-table="+b.attr("id")+"]").find(".btn").not(".btn-custom,.btn-create,.btn-update,.btn-delete").each(function(){var d=$(this);
var c=d.attr("href");
if(!c||c.indexOf("#")==0||c.indexOf("javascript:")==0){return
}d.off("click").on("click",function(){window.location.href=c+(c.indexOf("?")==-1?"?":"&")+"BackURL="+$.table.encodeTableURL(b);
return false
})});a=$.table.formatUrlPrefix(a,b);
if(b.hasClass("table-dblclick-edit")){b.children("tbody").children("tr").off("dblclick").on("dblclick",function(){var c=$(this).find(":checkbox[name=ids]").val();
window.location.href=a+"/"+c+"/update?BackURL="+$.table.encodeTableURL(b)
})}},getFirstSelectedCheckbox:function(a){var b=$("#table :checkbox:checked:first");
if(!b.length){if($(this).hasClass(".no-disable")==false){return b
}$.app.alert({message:"请先选择要操作的数据！"})
}return b},getAllSelectedCheckbox:function(a){var b=a.find(":checkbox:checked");
if(!b.length){if($(this).hasClass(".no-disable")==false){return b
}$.app.alert({message:"请先选择要操作的数据！"})
}return b}};
$.movable={initMoveableTable:function(d){if(!d.length){return
}var a=d.data("move-url-prefix");
if(!a){$.app.alert({message:"请添加移动地址URL，如&lt;table move-url-prefix='/sample'&gt;<br/>自动生成：/sample/{fromId}/{toId}/{direction:方向(up|down)}"})
}var c=function(h,f){var g=f.children();
var i=f.clone();
i.children().each(function(j){$(this).width(g.eq(j).width())
});return i
};d.find("tbody").sortable({helper:c,opacity:0.5,cursor:"move",placeholder:"sortable-placeholder",update:function(g,f){g.stopPropagation();
e(f.item.find(".moveable").closest("td"))
}});d.find("a.pop-movable[rel=popover]").mouseenter(function(h){var f=$(this);
f.popover("show");
var g=f.closest("tr").find(".id");
g.focus();f.next(".popover").find(".popover-up-btn,.popover-down-btn").click(function(){var k=$(this).closest("tr").prop("id");
var i=g.val();
if(!/\d+/.test(i)){$.app.alert({message:"请输入数字!"});
return}var j=$(this).closest("td");
if($(this).hasClass("popover-up-btn")){b(j,k,i,"up")
}else{b(j,k,i,"down")
}});f.parent().mouseleave(function(){f.popover("hide")
})});d.find(".up-btn,.down-btn").click(function(){var f=$(this).closest("tr");
if($(this).hasClass("up-btn")){f.prev("tr").before(f)
}else{f.next("tr").after(f)
}e($(this).closest("td"))
});function e(h){var j=h.closest("tr");
var i=j.prop("id");
var g=j.next("tr");
if(g.length){b(h,i,g.prop("id"),"down")
}else{var f=j.prev("tr");
b(h,i,f.prop("id"),"up")
}}function b(h,j,g,k){if(!(j&&g)){return
}var f=$.movable.tdOrder(h);
if(!f){$.app.alert({message:"请首先排序要移动的字段！"});
return}if(f=="desc"){if(k=="up"){k="down"
}else{k="up"
}}$.app.waiting("正在移动");
var i=a+"/"+j+"/"+g+"/"+k;
$.getJSON(i,function(l){$.app.waitingOver();
if(l.success){$.table.reloadTable(h.closest("table"))
}else{$.app.alert({message:l.message})
}})}},initMovableReweight:function(b,a){b.click(function(){$.app.confirm({message:"确定优化权重吗？<br/><strong>注意：</strong>优化权重执行效率比较低，请在本系统使用人员较少时执行（如下班时间）",ok:function(){$.app.waiting("优化权重执行中。。");
$.getJSON(a,function(c){$.app.waitingOver();
if(!c.success){$.app.alert({message:c.message})
}else{location.reload()
}})}})})},tdOrder:function(b){var a=b.closest("tr").children("td").index(b);
return b.closest("table").find("thead > tr > th").eq(a).prop("order")
}};$.btn={initChangeStatus:function(a,c,b){$(b.btns.join(",")).each(function(d){$(this).off("click").on("click",function(){var g=$("#"+c);
var i=$.table.getAllSelectedCheckbox(g);
if(i.size()==0){return
}var j=b.titles[d];
var h=b.messages[d];
var e=b.status[d];
var f=a+"/"+e+"?"+i.serialize();
$.app.confirm({title:j,message:h,ok:function(){window.location.href=f
}})})})},initChangeShowStatus:function(a,b){$.btn.initChangeStatus(a,b,{btns:[".status-show",".status-hide"],titles:["显示数据","隐藏数据"],messages:["确认显示数据吗？","确认隐藏数据吗？"],status:["true","false"]})
}};$.array={remove:function(c,b){if(c.length==0){return
}for(var a=c.length-1;
a>=0;a--){if(c[a]==b){c.splice(a,1)
}}},contains:function(c,b){if(c.length==0){return false
}for(var a=c.length-1;
a>=0;a--){if(c[a]==b){return true
}}return false
},indexOf:function(c,b){if(c.length==0){return -1
}for(var a=c.length-1;
a>=0;a--){if(c[a]==b){return a
}}return -1
},clear:function(a){if(a.length==0){return
}a.splice(0,a.length)
},trim:function(b){for(var a=b.length-1;
a>=0;a--){if(b[a]==""||b[a]==null){b.splice(a,1)
}}return b}};
(function(b,a,c){var d=b();
b.fn.dropdownHover=function(e){d=d.add(this.parent());
return this.each(function(){var j=b(this).parent(),i={delay:100,instantlyCloseOthers:true},h={delay:b(this).data("delay"),instantlyCloseOthers:b(this).data("close-others")},f=b.extend(true,{},i,e,h),g;
j.hover(function(){if(f.instantlyCloseOthers===true){d.removeClass("open")
}a.clearTimeout(g);
b(this).addClass("open")
},function(){g=a.setTimeout(function(){j.removeClass("open")
},f.delay)})
})};b(document).ready(function(){b('[data-hover="dropdown"]').dropdownHover()
})})(jQuery,this);
$(function(){$.ajaxSetup({cache:true});
$(".table").each(function(){$.table.initTable($(this))
});$.app.initDatetimePicker();
$.layout=top.$.layout;
$.tabs=top.$.tabs;
$.menus=top.$.menus;
$("[data-toggle='tooltip']").each(function(){$(this).tooltip({delay:300})
});$(document).ajaxError(function(c,b,a){$.app.waitingOver();
if(b.status==0){return
}top.$.app.alert({title:"网络故障/系统故障",message:b.responseText.replace(/(<refresh>.*<\/refresh>)/g,"")})
})});